var coreToolkit_version_date="\nLast modified: 2024/05/31 14:04:37\n";coreToolkit_version_date=coreToolkit_version_date.replace(/\n/g,"");var bles=[new Orphe(0),new Orphe(1)],cores=bles;function buildCoreToolkit(e,t,n=0,i="STEP_ANALYSIS_AND_SENSOR_VALUES",l={}){l.range=l.range||{acc:-1,gyro:-1},l.range&&-1!=l.range.acc&&-1!=l.range.gyro||(16==l.range.acc?l.range.acc=3:8==l.range.acc?l.range.acc=2:4==l.range.acc?l.range.acc=1:2==l.range.acc&&(l.range.acc=0),2e3==l.range.gyro?l.range.gyro=3:1e3==l.range.gyro?l.range.gyro=2:500==l.range.gyro?l.range.gyro=1:250==l.range.gyro&&(l.range.gyro=0));let a=CTbuildElement("div","","form-ckeck form-switch d-flex","",e);a.id=`core_toolkit${n}`;let o=CTbuildElement("input","","form-check-input position-relative","",a);o.setAttribute("type","checkbox"),o.setAttribute("role","switch"),o.setAttribute("id",`switch_ble${n}`),o.setAttribute("notification",i),o.setAttribute("value",`${n}`),o.setAttribute("title",`coreToolkit_version_date: ${coreToolkit_version_date}\norphe_js_version_date: ${orphe_js_version_date}`),o.addEventListener("change",(function(){toggleCoreModule(this,l)})),CTbuildElement("label",t,"form-check-label ms-1","",a);let s=CTbuildElement("span","","","",a);s.id=`ui${n}`,s.style.visibility="hidden";let r=CTbuildElement("span",`<i class="bi bi-activity position-relative">\n        <span class="position-absolute top-0 start-50 translate-middle badge text-muted" style="font-size:0.2em;"\n          id="freq${n}">\n        </span>\n      </i>`,"text-muted ms-1","",s);r.setAttribute("id",`freq${n}`),r.id=`icon_bluetooth${n}`;let c=CTbuildElement("span",'<i class="bi bi-battery"></i>',"text-muted ms-1","",s);c.id=`icon_battery${n}`,c.setAttribute("core_id",`${n}`),c.addEventListener("click",(function(){updateBatteryInfo(c)}));let b=CTbuildElement("span",`<i class="bi bi-brightness-alt-high position-relative"><span class="position-absolute  top-0 start-50 tanslate-middle badge text-muted bg-light" style="font-size:0.2em;" id="led_number${n}">\n          0\n        </span>\n      </i>`,"text-muted ms-1","",s);b.id=`icon_led${n}`,b.setAttribute("number","0"),b.setAttribute("value",`${n}`),b.addEventListener("click",(function(){toggleLED(b)}));let d=CTbuildElement("span",'<i\n        class="bi bi-gear"></i>',"text-muted ms-1","",s);d.id=`icon_settings${n}`,d.setAttribute("value",`${n}`),d.setAttribute("title","settings for notification, sensor ranges."),d.setAttribute("data-bs-toggle","modal"),d.setAttribute("data-bs-target",`#settings_modal${n}`),d.addEventListener("click",(function(){console.log("click"),updateModalParameters(parseInt(n))}));let u=CTbuildElement("div","","modal fade","",s);u.id=`settings_modal${n}`,u.setAttribute("tanindex","-1"),u.setAttribute("aria-labelledby","exampleModalLabel"),u.setAttribute("aria-hidden","true");let g=CTbuildElement("div","","modal-dialog text-dark","",u),m=CTbuildElement("div","","modal-content","",g),p=(CTbuildElement("div",`<h5 class="modal-title" id="exampleModalLabel"><i class="bi bi-gear"></i> CORE0${n} Settings</h5 >\n        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>`,"modal-header","",m),CTbuildElement("div",`<div class="form-floating mt-2">\n    <select class="form-select text-black" id="select_notify${n}" aria-label="Floating label select example"\n      onchange="changeNotify(${n}, this);">\n      <option value="STEP_ANALYSIS">STEP_ANALYSIS</option>\n      <option value="SENSOR_VALUES">SENSOR_VALUES</option>\n      <option value="STEP_ANALYSIS_AND_SENSOR_VALUES" selected>STEP_ANALYSIS_AND_SENSOR_VALUES</option>\n    </select>\n    <label for="select_notify${n}" class="small">Realtime data protocol[not available]</label>\n  </div>\n  <div class="form-floating mt-2">\n    <select class="form-select text-black" id="select_acc${n}" aria-label="Floating label select example"\n      onchange="changeAccRange(${n},this);">\n      <option value="0" selected>2</option>\n      <option value="1">4</option>\n      <option value="2">8</option>\n      <option value="3">16</option>\n    </select>\n    <label for="select_acc${n}" class="small">Accelerometer Range [g]</label>\n  </div>\n  <div class="form-floating mt-2">\n    <select class="form-select text-black" id="select_gyro${n}" aria-label="Floating label select example"\n      onchange="changeGryoRange(${n},this);">\n      <option value="0" selected>250</option>\n      <option value="1">500</option>\n      <option value="2">1000</option>\n      <option value="3">2000</option>\n    </select>\n    <label for="select_gyro${n}" class="small">Gryorscope Range [g]</label>\n  </div>\n  <div class="form-floating mt-2">\n    <select class="form-select text-black" id="select_lr${n}" aria-label="lr"\n    onchange="changeLR(${n},this);">\n      <option value="0" selected>LEFT</option>\n      <option value="1">RIGTH</option>\n    </select>\n    <label for="select_gyro${n}" class="small">LEFT/RIGHT</label>\n  </div>\n  <div class="d-grid gap-2 col-12 mx-auto mt-4">\n    <label for="range_brightness${n}" class="form-label small">LED Brightness</label>\n    <input type="range" class="form-range" min="0" max="255" step="1" id="range_brightness${n}" onchange="changeLEDBrightness(${n},this);">\n  </div>\n  <div class="d-grid gap-2 col-10 mx-auto mt-4">\n  <button class="btn btn-warning text-white" type="button" onclick="resetCoreModule(${n});">Reset\n    Attitude & Gait Analysis</button>\n</div>`,"modal-body","",m).querySelector(`#select_notify${n}`));"STEP_ANALYSIS"==i?p.options[0].selected=!0:"SENSOR_VALUES"==i?p.options[1].selected=!0:"STEP_ANALYSIS_AND_SENSOR_VALURS"==i&&(p.options[2].selected=!0)}async function toggleCoreModule(e,t={}){let n=e.checked,i=parseInt(e.value),l=bles[i],a=e.getAttribute("notification");if(1==n){if(!await l.begin(a,t))return void(document.querySelector(`#switch_ble${i}`).checked=!1);document.querySelector(`#ui${i}`).style.visibility="visible",l.gotBLEFrequency=function(e){document.querySelector(`#freq${this.id} `).innerHTML=`${Math.floor(e)} Hz`}}else l.reset(),document.querySelector(`#ui${i}`).style.visibility="hidden"}function changeNotify(e,t){"STEP_ANALYSIS"==bles[e].notification_type?bles[e].stopNotify("STEP_ANALYSIS").then((()=>{setTimeout((function(){bles[e].begin(t.value)}),500)})):"SENSOR_VALUES"==bles[e].notification_type?bles[e].stopNotify("SENSOR_VALUES").then((()=>{setTimeout((function(){bles[e].begin(t.value)}),500)})):"STEP_ANALYSIS_AND_SENSOR_VALUES"==bles[e].notification_type&&bles[e].stopNotify("STEP_ANALYSIS").then((()=>{bles[e].stopNotify("SENSOR_VALUES").then((()=>{setTimeout((function(){bles[e].begin(t.value)}),500)}))}))}async function changeAccRange(e,t){var n=await bles[e].getDeviceInformation();n.range.acc=parseInt(t.value),n.lr=255,bles[e].setDeviceInformation(n)}async function changeGryoRange(e,t){var n=await bles[e].getDeviceInformation();n.range.gyro=parseInt(t.value),n.lr=255,bles[e].setDeviceInformation(n)}async function changeLEDBrightness(e,t){var n=await bles[e].getDeviceInformation();n.led_brightness=parseInt(t.value),n.lr=255,bles[e].setDeviceInformation(n)}async function changeLR(e,t){var n=await bles[e].getDeviceInformation();n.lr=parseInt(t.value),bles[e].setDeviceInformation(n)}async function updateModalParameters(e){var t=await bles[e].getDeviceInformation();document.querySelector(`#select_acc${e} `).options[t.range.acc].selected=!0,document.querySelector(`#select_gyro${e} `).options[t.range.gyro].selected=!0,document.querySelector(`#range_brightness${e}`).value=t.led_brightness,document.querySelector(`#select_lr${e}`).options[t.lr].selected=!0}function resetCoreModule(e){bles[e].resetMotionSensorAttitude(),bles[e].resetAnalysisLogs()}async function updateBatteryInfo(e){let t=parseInt(e.getAttribute("core_id"));var n=await bles[t].getDeviceInformation();let i;0==n.battery?i="empty":1==n.battery?i="normal":2==n.battery&&(i="full"),document.querySelector(`#icon_battery${t} `).setAttribute("title",`${i} `),"0"==n.battery?(document.querySelector(`#icon_battery${t} `).innerHTML='<i class="bi bi-battery"></i>',document.querySelector(`#icon_battery${t} `).classList="text-warning"):"1"==n.battery?document.querySelector(`#icon_battery${t} `).innerHTML='<i class="bi bi-battery-half"></i>':"2"==n.battery&&(document.querySelector(`#icon_battery${t} `).innerHTML='<i class="bi bi-battery-full"></i>')}function toggleLED(e){let t=parseInt(e.getAttribute("number")),n=parseInt(e.getAttribute("value"));t++,t>6&&(t=0),document.querySelector(`#led_number${n} `).innerText=t,0==t?bles[n].setLED(0,0):bles[n].setLED(1,t),e.setAttribute("number",t)}function setHeaderStatusOffline(e){document.querySelector(`#switch_ble${e} `).checked=!1}function CTbuildElement(e,t,n,i,l){let a=document.createElement(e);return a.innerHTML=t,a.classList=n,""!=i&&a.setAttribute("style",i),l.appendChild(a),a}